
<!-- Outer -->
<template name="autoProfile">
  {{#with options}}
    <div class="autoprofile-container target profile">
      {{#if containers}}
        <div class="row cf-dfs-outer-row">
          {{#each containers}}
            <div class="{{class}}">
              {{#each rows}}
                {{>autoProfileRow}}
              {{/each}}
            </div>
          {{/each}}
        </div>
      {{else}}
        {{#each rows}}
          {{>autoProfileRow}}
        {{/each}}
      {{/if}}

      {{#afModal  formId=getEditFormId
                  fields=getFields
                  collection=getCollectionName
                  meteormethod=getMethod
                  meteormethodargs=getMethodArgs
                  doc=getDocId
                  callContext=getCallContext
                  meteorupdatemethod="enhancedmethod"
                  operation="update"
                  buttonContent="Speichern"
                  buttonClasses="btn cf-button-modals p-2"
                  placeholder=true
                  template = "bootstrap4"
                  title="Profil bearbeiten"
                  backdrop=true
                  class="btn btn-primary cf-button-primary js-edit-field-afmodalbutton d-none"
                  validationScope="fields"
                  validation="keyup"
                  doNotClean=true
      }}<span class="icon-user"></span> Profil bearbeiten{{/afModal}}

      {{#afModal  formId="AutoProfileAddArrayItemForm"
                  fields=getFields
                  collection=getCollectionName
                  meteormethod=getMethod
                  doc=getDocId
                  callContext=getCallContext
                  operation="update"
                  buttonContent="Speichern"
                  buttonClasses="btn cf-button-modals p-2"
                  placeholder=true
                  template = "bootstrap4"
                  title="Eintrag Hinzufügen"
                  backdrop=true
                  class="btn btn-primary cf-button-primary js-add-array-item-afmodalbutton d-none"
      }}<span class="icon-user"></span> Hinzufügen{{/afModal}}

      {{#afModal  formId="AutoProfileCreateReferenceDocAndAddArrayItemForm"
                  fields=getFields
                  collection=getCollectionName
                  meteormethod=getMethod
                  callContext=getCallContext
                  operation="insert"
                  buttonContent="Erstellen"
                  buttonClasses="btn cf-button-modals p-2"
                  placeholder=true
                  template = "bootstrap4"
                  title="Eintrag Hinzufügen"
                  backdrop=true
                  class="btn btn-primary cf-button-primary js-create-reference-doc-and-add-array-item-afmodalbutton d-none"
      }}<span class="icon-user"></span> erstellen{{/afModal}}
    </div>
  {{else}}
    NO options found!
  {{/with}}
</template>

<template name="autoProfileRow">
  <div class="row">
    {{#each cols}}
      {{>autoProfileCol}}
    {{/each}}
  </div>
</template>

<template name="autoProfileCol">
  <div class="{{class}}">
    {{#each panels}}
      {{#if cols}}
        {{>autoProfileRow}}
      {{else}}
        {{>autoProfilePanel}}
      {{/if}}
    {{/each}}
  </div>
</template>


<!-- Profile Panel -->
<template name="autoProfilePanel">
  {{#if contentOnly}}
    {{#with field}}
      {{> DynamicTemplate template=getTemplate data=this}}
    {{/with}}
    {{#each fields}}
      {{> DynamicTemplate template=getTemplate data=this}}
    {{/each}}
  {{else}}

    <div class="{{cardOrPanel}} {{cardOrPanel}}-default {{#if listContent}}list-{{cardOrPanel}}{{/if}} {{#if highlighted}}highlighted{{/if}}">

      <div class="{{cardOrPanel}}-{{headerOrHeading}}  cf-card__card-header">
        {{#with titleField}}
          {{#if group}}
            {{#each group}}
              {{> DynamicTemplate template=getTemplate data=this}}
            {{/each}}
          {{else}}
            {{> DynamicTemplate template=getTemplate data=this}}
          {{/if}}
        {{else}}
          {{panelTitle}}
          {{#if icon}}
            <i class="fa fa-{{icon}} fa-1x"></i>
          {{/if}}
        {{/with}}
      </div>

      {{#if valueOnly}}
        {{#if noBody}}
          {{#with field}}
            {{> DynamicTemplate template=getTemplate data=this}}
          {{/with}}
          {{#each fields}}
            {{> DynamicTemplate template=getTemplate data=this}}
          {{/each}}
        {{else}}
          <div class="card-body">
            {{#with field}}
              {{> DynamicTemplate template=getTemplate data=this}}
            {{/with}}
            {{#each fields}}
              {{> DynamicTemplate template=getTemplate data=this}}
            {{/each}}
          </div>
        {{/if}}
      {{else if $eq view "table"}}
        <table class="table">
          {{#with field}}
            <tr><td>{{fieldTitle}}</td><td>{{> DynamicTemplate template=getTemplate data=this}}</td></tr>
          {{/with}}
          {{#each fields}}
            <tr><td>{{fieldTitle}}</td><td>{{> DynamicTemplate template=getTemplate data=this}}</td></tr>
          {{/each}}
        </table>
      {{else if $eq view "carddeck"}}
        <div class="card-body">

          {{#each decks}}
            <div class="card-deck">
              {{#each fields}}
                <div class="card">
                  <div class="card-body">
                    {{> DynamicTemplate template=getTemplate data=this}}
                  </div>
                </div>
              {{/each}}
            </div>
          {{/each}}

          {{!--
          <div class="card-deck">
            <div class="card">
              <div class="card-body">

                <span class="float-right icon-check cf-icon cf-icon-big"> </span>
                <a href="/dealcockpit/eAWoBvrJNrAjxJfiW?initialItem=7LGdLzvoN8BRaddqs">Objektbilder</a>

              </div>
            </div>
            <div class="card">
              <div class="card-body">

                <span class="float-right icon-cross cf-icon cf-icon-big"> </span> Flurkarte / Lageplan

              </div>
            </div>
          </div>
          --}}

        </div>
      {{else}}
        <ul class="list-group">

          {{#with field}}
            {{#if group}}
              <li class="list-group-item text-right"><span class="pull-left"><strong>{{fieldTitle}}</strong></span>
                {{#each group}}
                  {{> DynamicTemplate template=getTemplate data=this}}
                {{/each}}
              </li>
            {{else}}
              <li class="list-group-item text-right"><span class="pull-left"><strong>{{fieldTitle}}</strong></span>{{> DynamicTemplate template=getTemplate data=this}}</li>
            {{/if}}
          {{/with}}

          {{#each fields}}
            {{#if group}}
              <li class="list-group-item text-right"><span class="pull-left"><strong>{{fieldTitle}}</strong></span>
                {{#each group}}
                  {{> DynamicTemplate template=getTemplate data=this}}
                {{/each}}
              </li>
            {{else}}
              <li class="list-group-item text-right"><span class="pull-left"><strong>{{fieldTitle}}</strong></span>{{> DynamicTemplate template=getTemplate data=this}}</li>
            {{/if}}
          {{/each}}

        </ul>
      {{/if}}

    </div>
  {{/if}}
</template>


<!-- Value Rendering -->
<template name="autoProfileFieldHelper_editable">
  {{#if $and editingEnabled useEditableText}}
    {{> editableText
          context=context collection="freelancers" field=field
          wysiwyg=wysiwyg acceptEmpty=acceptEmpty substitute=substitute class=class inputClass=inputClass
    }}
  {{else}}
    <span id="autoprofile-field-{{field}}" data-field-id="{{field}}" class="autoprofile-field {{#if isEditable}}editable{{/if}}">
      {{#if fieldValue}}
        {{#if isMarkdown}}
          {{#markdown}}{{fieldValue}}{{/markdown}}
        {{else if isHTML}}
          {{{fieldValue}}}
        {{else if urlFieldValue}}
          <a href="{{urlFieldValue}}" target="_blank">{{fieldValue}}</a>
        {{else if isUrl}}
          <a href="{{fieldValue}}" target="_blank">{{fieldValue}}</a>
        {{else}}
          {{fieldValue}}
        {{/if}}
      {{else}}
        ?
      {{/if}}
    </span>
  {{/if}}
</template>
