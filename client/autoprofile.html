
<!-- Outer -->
<template name="autoProfile">
  {{#with options}}
    <div class="autoprofile-container target profile">
      {{#each rows}}
        {{>autoProfileRow}}
      {{/each}}
      {{#afModal  formId="editUserAutoProfileForm"
                  fields=getFields
                  collection="Meteor.users"
                  operation="update"
                  meteormethod="accountsAdminUi.updateUserProfile"
                  buttonContent="Speichern"
                  buttonClasses="btn cf-button-modals p-2"
                  doc=getContext._id
                  prompt=""
                  title="Profil bearbeiten"
                  backdrop="true"
                  placeholder="test"
                  class="btn btn-primary cf-button-primary js-user-edit-field-afmodalbutton"
      }}<span class="icon-user"></span> Profil bearbeiten{{/afModal}}
    </div>
  {{else}}
    NO options found!
  {{/with}}

  {{#afModal  formId="editUserProfileForm"
              fields="profile.emailAdresses.1"
              collection="Meteor.users"
              operation="update"
              meteormethod="accountsAdminUi.updateUserProfile"
              buttonContent="Speichern"
              buttonClasses="btn cf-button-modals p-2"
              doc=getContext._id
              prompt=""
              title="Profil bearbeiten"
              backdrop="true"
              placeholder="test"
              class="btn btn-primary cf-button-primary js-user-edit-afmodalbutton d-none"
  }}<span class="icon-user"></span> Profil XX bearbeiten{{/afModal}}
</template>

<template name="autoProfileRow">
  <div class="row">
    {{#each cols}}
      {{>autoProfileCol}}
    {{/each}}
  </div>
</template>

<template name="autoProfileCol">
  <div class="{{class}}">
    {{#each panels}}
      {{#if cols}}
        {{>autoProfileRow}}
      {{else}}
        {{>autoProfilePanel}}
      {{/if}}
    {{/each}}
  </div>
</template>


<!-- Profile Panel -->
<template name="autoProfilePanel">
  {{#if contentOnly}}
    {{#with field}}
      {{> DynamicTemplate template=getTemplate data=this}}
    {{else}}
      <ul class="list-group">
        {{#each fields}}
          {{> DynamicTemplate template=getTemplate data=this}}
        {{/each}}
      </ul>
    {{/with}}
  {{else}}
    <div class="{{cardOrPanel}} {{cardOrPanel}}-default {{#if listContent}}list-{{cardOrPanel}}{{/if}} {{#if highlighted}}highlighted{{/if}}">
      <div class="{{cardOrPanel}}-{{headerOrHeading}}  cf-card__card-header">
        {{#if titleField}}
          {{> DynamicTemplate template=getTemplate data=titleField}}
        {{else}}
          {{panelTitle}}
          {{#if icon}}
            <i class="fa fa-{{icon}} fa-1x"></i>
          {{/if}}
        {{/if}}
      </div>
      {{#with field}}
          {{> DynamicTemplate template=getTemplate data=this}}
      {{else}}
        <ul class="list-group">
          {{#each fields}}
            {{> DynamicTemplate template=getTemplate data=this}}
          {{/each}}
        </ul>
      {{/with}}
    </div>
  {{/if}}
</template>


<!-- Value Rendering -->
<template name="autoProfileFieldHelper_editable">
  {{#if editingEnabled}}
    {{> editableText
          context=context collection="freelancers" field=field
          wysiwyg=wysiwyg acceptEmpty=acceptEmpty substitute=substitute class=class inputClass=inputClass
    }}
  {{else}}
    <span id="autoprofile-field-{{field}}" data-field-id="{{field}}" class="autoprofile-field {{#if isEditable}}editable{{/if}}">
      {{#if fieldValue}}
        {{#if isMarkdown}}
          {{#markdown}}{{fieldValue}}{{/markdown}}
        {{else}}
          {{#if isHTML}}
            {{{fieldValue}}}
          {{else}}
            {{#if urlFieldValue}}
              <a href="{{urlFieldValue}}" target="_blank">{{fieldValue}}</a>
            {{else}}
              {{#if isUrl}}
                <a href="{{fieldValue}}" target="_blank">{{fieldValue}}</a>
              {{else}}
                {{fieldValue}}
              {{/if}}
            {{/if}}
          {{/if}}
        {{/if}}
      {{else}}
        ?
      {{/if}}
    </span>
  {{/if}}
</template>



<!-- References -->
<template name="autoProfileField_string_reference">
  {{#if contentOnly}}
    <a href="{{referenceUrl}}">{{referenceLabel}}</a>
  {{else}}
    <li class="list-group-item text-right">
      <span class="pull-left"><strong>{{fieldTitle}}</strong></span>
      {{#if referenceLabel}}
        <a href="{{referenceUrl}}">{{referenceLabel}}</a>
      {{else}}
        ?
      {{/if}}
    </li>
  {{/if}}
</template>


<!-- Field Types -->
<template name="autoProfileField_string">
{{#if group}}
  {{#each group}}
    {{>autoProfileFieldHelper_editable urlFieldValue=urlFieldValue fieldOptions=this isUrl=isUrl isHTML=isHTML isMarkdown=isMarkdown editingEnabled=editingEnabled context=context field=id fieldValue=fieldValue substitute='<i class="fa fa-pencil"></i>'}}
  {{/each}}
{{else}}
  {{#if contentOnly}}
    {{>autoProfileFieldHelper_editable urlFieldValue=urlFieldValue fieldOptions=this isUrl=isUrl isHTML=isHTML isMarkdown=isMarkdown editingEnabled=editingEnabled context=context field=id fieldValue=fieldValue substitute='<i class="fa fa-pencil"></i>'}}
  {{else}}
    <li class="list-group-item text-right">
      <span class="pull-left"><strong>{{fieldTitle}}</strong></span>
      {{>autoProfileFieldHelper_editable urlFieldValue=urlFieldValue fieldOptions=this isUrl=isUrl isHTML=isHTML isMarkdown=isMarkdown editingEnabled=editingEnabled context=context field=id fieldValue=fieldValue substitute='<i class="fa fa-pencil"></i>'}}
    </li>
  {{/if}}
{{/if}}
</template>

<template name="autoProfileField_string_textarea">
  {{>autoProfileFieldHelper_editable urlFieldValue=urlFieldValue fieldOptions=this isUrl=isUrl isHTML=isHTML isMarkdown=isMarkdown editingEnabled=editingEnabled context=context field=id fieldValue=fieldValue wysiwyg=true acceptEmpty=true substitute='<i class="fa fa-pencil"></i>' class="post-body" inputClass="post-body-wysiwyg"}}
</template>

<template name="autoProfileField_image">
  {{#if fieldValue}}
    <img id="autoprofile-field-{{fieldId}}" data-field-id="{{fieldId}}" class="autoprofile-field {{#if isEditable}}editable{{/if}}" src="/cdn/storage/{{fieldValue._collectionName}}/{{fieldValue._id}}/original/{{fieldValue._id}}.{{fieldValue.extension}}" width="320" />
  {{else}}
    {{#if placeholder}}
      <img id="autoprofile-field-{{fieldId}}" data-field-id="{{fieldId}}" class="autoprofile-field {{#if isEditable}}editable{{/if}}" src="{{placeholder}}" width="320" /> <!--nobody.jpg-->
    {{/if}}
  {{/if}}
</template>

<template name="autoProfileField_file">
  <li class="list-group-item text-right">
    <span class="pull-left"><strong>{{fieldTitle}}</strong></span>
    {{#if fieldValue}}
      <a href="/cdn/storage/{{fieldValue._collectionName}}/{{fieldValue._id}}/original/{{fieldValue._id}}.{{fieldValue.extension}}" target="_blank">{{fieldValue.name}}</a>
    {{else}}
      ?
    {{/if}}
  </li>
</template>

<template name="autoProfileField_date">
  <li class="list-group-item text-right">
    <span class="pull-left"><strong>{{fieldTitle}}</strong></span>
    {{fieldValue}}
  </li>
</template>

<template name="autoProfileField_array">
  <ul class="list-group" data-field-id="{{fieldId}}" data-field-type="autoProfileField_array">
    {{#each fieldValue}}
      <li class="list-group-item text-muted" data-array-index="{{@index}}">
        {{this}}
      </li>
    {{/each}}
  </ul>
</template>

<template name="autoProfileField_array_object">
  {{#if renderInplace}}
    <ul class="list-group" data-field-id="{{fieldId}}" data-field-type="autoProfileField_array_object">
      {{#each fieldValue}}
        <li class="list-group-item text-right autoprofile-field {{#if isEditable}}editable{{/if}}" data-array-index="{{@index}}" data-parent-field-id="{{..fieldId}}">
          <span class="pull-left"><strong>{{{titleFieldValue}}}</strong></span>
          {{#if isFileField}}
            {{>autoProfileField_file}}
          {{else}}
            {{{contentFieldValue}}}
          {{/if}}
        </li>
      {{/each}}
    </ul>
  {{else}}
    <!--SUBLIST: TODO-->
    <ul class="list-group" data-field-id="{{fieldId}}" data-field-type="autoProfileField_array_object">
      {{#each fieldValue}}
        <li class="list-group-item text-right autoprofile-field {{#if isEditable}}editable{{/if}}" data-array-index="{{@index}}">
          <strong class="pull-left">{{{titleFieldValue}}}</strong>
          {{#if isFileField}}
            {{>autoProfileField_file}}
          {{else}}
            {{{contentFieldValue}}}
          {{/if}}
        </li>
      {{/each}}
    </ul>
  {{/if}}
</template>


<template name="autoProfileField_object">
  {{fieldValueAsJSON}}
</template>