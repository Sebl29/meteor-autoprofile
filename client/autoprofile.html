
<!-- Outer -->
<template name="autoProfile">
  {{#with options}}
    <div class="autoprofile-container target profile">
      {{#if containers}}
        <div class="row cf-dfs-outer-row">
          {{#each containers}}
            <div class="{{class}}">
              {{#each rows}}
                {{>autoProfileRow}}
              {{/each}}
            </div>
          {{/each}}
        </div>
      {{else}}
        {{#each rows}}
          {{>autoProfileRow}}
        {{/each}}
      {{/if}}
      {{#afModal  formId="editUserAutoProfileForm"
                  fields=getFields
                  collection=getOptions.collectionName
                  meteormethod=getOptions.method
                  doc=getContext._id
                  meteorupdatemethod="enhancedmethod"
                  operation="update"
                  buttonContent="Speichern"
                  buttonClasses="btn cf-button-modals p-2"
                  placeholder=true
                  template = "bootstrap4"
                  title="Profil bearbeiten"
                  backdrop="true"
                  class="btn btn-primary cf-button-primary js-edit-field-afmodalbutton d-none"
      }}<span class="icon-user"></span> Profil bearbeiten{{/afModal}}

      {{#afModal  formId="addUserAutoProfileArrayItemForm"
                  fields=getFields
                  collection=getOptions.collectionName
                  meteormethod=getOptions.method
                  doc=getContext._id
                  meteorupdatemethod="enhancedmethod"
                  operation="update"
                  buttonContent="Speichern"
                  buttonClasses="btn cf-button-modals p-2"
                  placeholder=true
                  template = "bootstrap4"
                  title="Eintrag Hinzufügen"
                  backdrop="true"
                  class="btn btn-primary cf-button-primary js-add-array-item-afmodalbutton d-none"
      }}<span class="icon-user"></span> Hinzufügen{{/afModal}}
    </div>
  {{else}}
    NO options found!
  {{/with}}
</template>

<template name="autoProfileRow">
  <div class="row">
    {{#each cols}}
      {{>autoProfileCol}}
    {{/each}}
  </div>
</template>

<template name="autoProfileCol">
  <div class="{{class}}">
    {{#each panels}}
      {{#if cols}}
        {{>autoProfileRow}}
      {{else}}
        {{>autoProfilePanel}}
      {{/if}}
    {{/each}}
  </div>
</template>


<!-- Profile Panel -->
<template name="autoProfilePanel">
  {{#if contentOnly}}
    {{#with field}}
      {{> DynamicTemplate template=getTemplate data=this}}
    {{/with}}
    {{#each fields}}
      {{> DynamicTemplate template=getTemplate data=this}}
    {{/each}}
  {{else}}

    <div class="{{cardOrPanel}} {{cardOrPanel}}-default {{#if listContent}}list-{{cardOrPanel}}{{/if}} {{#if highlighted}}highlighted{{/if}}">

      <div class="{{cardOrPanel}}-{{headerOrHeading}}  cf-card__card-header">
        {{#with titleField}}
          {{#if group}}
            {{#each group}}
              {{> DynamicTemplate template=getTemplate data=this}}
            {{/each}}
          {{else}}
            {{> DynamicTemplate template=getTemplate data=this}}
          {{/if}}
        {{else}}
          {{panelTitle}}
          {{#if icon}}
            <i class="fa fa-{{icon}} fa-1x"></i>
          {{/if}}
        {{/with}}
      </div>

      {{#if valueOnly}}
        {{#with field}}
          {{> DynamicTemplate template=getTemplate data=this}}
        {{/with}}
        {{#each fields}}
          {{> DynamicTemplate template=getTemplate data=this}}
        {{/each}}
      {{else if $eq view "table"}}
        <table class="table">
          {{#with field}}
            <tr><td>{{fieldTitle}}</td><td>{{> DynamicTemplate template=getTemplate data=this}}</td></tr>
          {{/with}}
          {{#each fields}}
            <tr><td>{{fieldTitle}}</td><td>{{> DynamicTemplate template=getTemplate data=this}}</td></tr>
          {{/each}}
        </table>
      {{else}}
        <ul class="list-group">

          {{#with field}}
            {{#if group}}
              <li class="list-group-item text-right"><span class="pull-left"><strong>{{fieldTitle}}</strong></span>
                {{#each group}}
                  {{> DynamicTemplate template=getTemplate data=this}}
                {{/each}}
              </li>
            {{else}}
              <li class="list-group-item text-right"><span class="pull-left"><strong>{{fieldTitle}}</strong></span>{{> DynamicTemplate template=getTemplate data=this}}</li>
            {{/if}}
          {{/with}}

          {{#each fields}}
            {{#if group}}
              <li class="list-group-item text-right"><span class="pull-left"><strong>{{fieldTitle}}</strong></span>
                {{#each group}}
                  {{> DynamicTemplate template=getTemplate data=this}}
                {{/each}}
              </li>
            {{else}}
              <li class="list-group-item text-right"><span class="pull-left"><strong>{{fieldTitle}}</strong></span>{{> DynamicTemplate template=getTemplate data=this}}</li>
            {{/if}}
          {{/each}}

        </ul>
      {{/if}}

    </div>
  {{/if}}
</template>


<!-- Value Rendering -->
<template name="autoProfileFieldHelper_editable">
  {{#if editingEnabled}}
    {{> editableText
          context=context collection="freelancers" field=field
          wysiwyg=wysiwyg acceptEmpty=acceptEmpty substitute=substitute class=class inputClass=inputClass
    }}
  {{else}}
    <span id="autoprofile-field-{{field}}" data-field-id="{{field}}" class="autoprofile-field {{#if isEditable}}editable{{/if}}">
      {{#if fieldValue}}
        {{#if isMarkdown}}
          {{#markdown}}{{fieldValue}}{{/markdown}}
        {{else}}
          {{#if isHTML}}
            {{{fieldValue}}}
          {{else}}
            {{#if urlFieldValue}}
              <a href="{{urlFieldValue}}" target="_blank">{{fieldValue}}</a>
            {{else}}
              {{#if isUrl}}
                <a href="{{fieldValue}}" target="_blank">{{fieldValue}}</a>
              {{else}}
                {{fieldValue}}
              {{/if}}
            {{/if}}
          {{/if}}
        {{/if}}
      {{else}}
        ?
      {{/if}}
    </span>
  {{/if}}
</template>



<!-- References -->
<template name="autoProfileField_string_reference">
  {{#if contentOnly}}
    {{#if referenceLabel}}
      <a href="{{referenceUrl}}">{{referenceLabel}}</a>
    {{else}}
      ?
    {{/if}}
  {{else}}
    <li class="list-group-item text-right">
      <span class="pull-left"><strong>{{fieldTitle}}</strong></span>
      {{#if referenceLabel}}
        <a href="{{referenceUrl}}">{{referenceLabel}}</a>
      {{else}}
        ?
      {{/if}}
    </li>
  {{/if}}
</template>

<template name="autoProfileField_fileReference">
  autoProfileField_fileReference: {{fieldValue}} {{referencedObject}}
  {{#if fieldValue}}
    <img id="autoprofile-field-{{fieldId}}" data-field-id="{{fieldId}}" class="autoprofile-field {{#if isEditable}}editable{{/if}}" src="/cdn/storage/{{fieldValue._collectionName}}/{{fieldValue._id}}/original/{{fieldValue._id}}.{{fieldValue.extension}}" width="320" />
  {{else}}
    {{#if placeholder}}
      <img id="autoprofile-field-{{fieldId}}" data-field-id="{{fieldId}}" class="autoprofile-field {{#if isEditable}}editable{{/if}}" src="{{placeholder}}" width="320" /> <!--nobody.jpg-->
    {{/if}}
  {{/if}}
</template>


<!-- Field Types -->
<template name="autoProfileField_string">
  {{>autoProfileFieldHelper_editable urlFieldValue=urlFieldValue fieldOptions=this isUrl=isUrl isHTML=isHTML isMarkdown=isMarkdown editingEnabled=editingEnabled context=context field=id fieldValue=fieldValue substitute='<i class="fa fa-pencil"></i>'}}
</template>

<template name="autoProfileField_string_textarea">
  {{>autoProfileFieldHelper_editable urlFieldValue=urlFieldValue fieldOptions=this isUrl=isUrl isHTML=isHTML isMarkdown=isMarkdown editingEnabled=editingEnabled context=context field=id fieldValue=fieldValue wysiwyg=true acceptEmpty=true substitute='<i class="fa fa-pencil"></i>' class="post-body" inputClass="post-body-wysiwyg"}}
</template>

<template name="autoProfileField_image">
  {{#if fieldValue}}
    <img id="autoprofile-field-{{fieldId}}" data-field-id="{{fieldId}}" class="autoprofile-field {{#if isEditable}}editable{{/if}}" src="/cdn/storage/{{fieldValue._collectionName}}/{{fieldValue._id}}/original/{{fieldValue._id}}.{{fieldValue.extension}}" width="320" />
  {{else}}
    {{#if placeholder}}
      <img id="autoprofile-field-{{fieldId}}" data-field-id="{{fieldId}}" class="autoprofile-field {{#if isEditable}}editable{{/if}}" src="{{placeholder}}" width="320" /> <!--nobody.jpg-->
    {{/if}}
  {{/if}}
</template>

<template name="autoProfileField_file">
  <span class="pull-left"><strong>{{fieldTitle}}</strong></span>
  {{#if fieldValue}}
    <a href="/cdn/storage/{{fieldValue._collectionName}}/{{fieldValue._id}}/original/{{fieldValue._id}}.{{fieldValue.extension}}" target="_blank">{{fieldValue.name}}</a>
  {{else}}
    ?
  {{/if}}
</template>

<template name="autoProfileField_date">
  <span id="autoprofile-field-{{fieldId}}" class="autoprofile-field" data-field-id="{{fieldId}}">{{fieldValue}}</span>
</template>

<template name="autoProfileField_object">
  {{fieldValueAsJSON}}
</template>

<!-- TODO: make it possible to somehow switch view here -->
<template name="autoProfileField_array">
  <ul class="list-group" data-field-id="{{fieldId}}" data-field-type="autoProfileField_array">
    {{#each fieldValue}}
      <li class="list-group-item text-muted" data-array-index="{{@index}}">
        {{this}}
      </li>
    {{/each}}
  </ul>
</template>

<template name="autoProfileField_array_object">
  {{#if renderInplace}}
    <ul class="list-group" data-field-id="{{fieldId}}" data-field-type="autoProfileField_array_object">
      {{#each fieldValue}}
        <li class="list-group-item text-right autoprofile-field {{#if isEditable}}editable{{/if}}" data-array-index="{{@index}}" data-parent-field-id="{{..fieldId}}">
          <span class="pull-left"><strong>{{{titleFieldValue}}}</strong></span>
          {{#if isFileField}}
            {{>autoProfileField_file}}
          {{else}}
            {{{contentFieldValue}}}
          {{/if}}
          {{#if isEditable}}
            <button type="button" class="btn btn-primary btn-sm js-autoprofile-remove-array-item"><span class="icon icon-minus"></span></button>
          {{/if}}
        </li>
      {{/each}}
      {{#if isEditable}}
        <button type="button" class="btn btn-primary btn-sm js-autoprofile-add-array-item" data-autoform-field="{{this.atts.name}}"><span class="icon icon-plus"></span></button>
      {{/if}}
    </ul>
  {{else}}
    <!--SUBLIST: TODO-->
    <ul class="list-group" data-field-id="{{fieldId}}" data-field-type="autoProfileField_array_object">
      {{#each fieldValue}}
        <li class="list-group-item text-right autoprofile-field {{#if isEditable}}editable{{/if}}" data-array-index="{{@index}}">
          <strong class="pull-left">{{{titleFieldValue}}}</strong>
          {{#if isFileField}}
            {{>autoProfileField_file}}
          {{else}}
            {{{contentFieldValue}}}
          {{/if}}
          {{#if isEditable}}
            <button type="button" class="btn btn-primary btn-sm js-autoprofile-remove-array-item"><span class="icon icon-minus"></span></button>
          {{/if}}
        </li>
      {{/each}}
      {{#if isEditable}}
        <button type="button" class="btn btn-primary btn-sm js-autoprofile-add-array-item" data-autoform-field="{{this.atts.name}}"><span class="icon icon-plus"></span></button>
      {{/if}}
    </ul>
  {{/if}}
</template>
